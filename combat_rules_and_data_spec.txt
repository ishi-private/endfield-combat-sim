================================================================
  アークナイツ：エンドフィールド — 戦闘ルールとデータ仕様書
  （シミュレーター v0.6 対応）
================================================================

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  第1章　戦闘ルール
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

■ 1-1. 攻撃手段
各キャラクターは以下の4種類の攻撃手段を持つ。

  ① 通常攻撃（重攻撃）
      ・一定の間隔（loop_sec）ごとに自動発動する。
      ・発動ごとにSPとブレイク値（BRK）を獲得する。
      ・アルデリアの連携技など、重攻撃をトリガーとする連携技が存在する。

  ② 戦技
      ・SP（スキルポイント）を100消費して発動する。
      ・クラッシュ段階の変化（転倒・浮遊・破砕）、脆弱付与などの効果を持つ。

  ③ 連携技
      ・特定のトリガー条件を満たしたときに自動発動する。
      ・発動後はクールダウン（CD）が設定され、再発動まで時間が必要。

  ④ 必殺技
      ・必殺技ゲージ（ULT Gauge）が規定コストに達すると発動可能になる。
      ・ゲージ計算式: (6.5×NSC + 10×CSC) × (1 + USG×0.01) ≥ USC
          NSC : チーム全員の戦技使用回数合計
          CSC : 対象キャラの連携技使用回数
          USG : 必殺技強化値（キャラ固有）
          USC : 必殺技コスト（キャラ固有）

------------------------------------------------------------

■ 1-2. ダメージ属性
各攻撃手段は以下の5種類のいずれかのダメージ属性を持つ。

  物理 / 灼熱 / 電磁 / 寒冷 / 自然

  【現在の4キャラの属性】
  ・リーフォン        : 全攻撃手段が「物理」
  ・ポグラニチニク    : 全攻撃手段が「物理」
  ・チェン・センユー  : 全攻撃手段が「物理」
  ・アルデリア        : 全攻撃手段が「自然」

------------------------------------------------------------

■ 1-3. SPシステム
  ・SP初期値 : 200
  ・SP上限   : 300
  ・SP自然回復: 8 / 秒（常時）
  ・戦技消費 : 100
  ・SPは上限を超えない。戦技発動後は消費分だけ減少する。

------------------------------------------------------------

■ 1-4. クラッシュシステム（物理異常）
物理攻撃には、敵のクラッシュ段階を変化させる物理異常効果がある。

  [クラッシュ段階] 0段（通常）〜 4段（最大）

  【物理異常の種類】
  ① 転倒（Knockdown）: クラッシュ段階を +1（上限4）
  ② 浮遊（Float）    : クラッシュ段階を +1（上限4）
  ③ 破砕（Crush）    : クラッシュ段階を消費し0にリセット。効果を発動する。
                         段階0の場合はクラッシュ段階を +1（効果なし）
  ④ 猛撃（Savage）   : （現在のキャラには未実装）

  【破砕の効果（段階別）】
  消費段階  物理ダメージ上昇  効果持続時間
  ─────── ─────────────── ───────────
    1段      15%              12秒
    2段      20%              18秒
    3段      25%              24秒
    4段      30%              30秒

  ※ 物理ダメージ上昇はシミュレーター内では計算に使用せず、データとして保持する。

------------------------------------------------------------

■ 1-5. デバフ状態
敵に付与されるデバフは以下の通り。

  ① 脆弱（Vulnerable）
      ・物理脆弱 / アーツ脆弱 の2種類が存在する。
      ・複数のキャラが異なる脆弱を同時に付与でき、重複する。
      ・効果量（%）と持続時間はキャラおよびスキルランクによって異なる。

  ② 腐食（Corrosion）
      ・アルデリアの連携技「イラプション・コラム」が付与する。
      ・腐食状態でアルデリアの戦技「ドリーラッシュ」を発動すると、
        腐食を消費して脆弱（物理/アーツ）を付与する。
      ・持続時間は固定（現在: 7秒）。

  ③ 破砕効果（Crush Effect）
      ・ポグラニチニクの戦技「戦線粉砕」が発動する。
      ・消費したクラッシュ段階に応じた時間・効果が適用される（1-4参照）。

------------------------------------------------------------

■ 1-6. アーツ付着
  ・アーツ付着という概念が存在する。
  ・現在の4キャラにはアーツ付着効果を持つ攻撃手段は存在しない。
  ・今後追加されるキャラで実装予定。

------------------------------------------------------------

■ 1-7. リンク状態
  ・リーフォンの連携技「忿怒形」が発動すると「リンク状態」が付与される。
  ・リンク状態は次の戦技または必殺技の発動時に消費される。
  ・消費時、対象スキルに追加ボーナス効果（★リンク）が付与される。

------------------------------------------------------------

■ 1-8. 各キャラの連携技トリガー条件

  リーフォン「忿怒形」
      トリガー: 操作キャラの重攻撃 かつ（クラッシュ段階 > 0 または 脆弱中）
      効果    : リンク状態を付与

  ポグラニチニク「満月迎撃」
      トリガー: 破砕（戦技発動）時に消費したクラッシュ段階に応じてSP回復
      効果    : 消費段階別SP回復（1段:5 / 2段:12 / 3段:25 / 4段:48）

  アルデリア「イラプション・コラム」
      トリガー: いずれかのキャラの重攻撃 かつ クラッシュ=0 かつ アーツ付着なし
      効果    : 腐食を付与（7秒）
      ※ アルデリア優先戦略の選択有無にかかわらず、条件を満たせば常時発動

  チェン・センユー「天河昇」
      トリガー: クラッシュ段階が増加したとき
      効果    : 追加で浮遊（クラッシュ段階 +1）を付与

------------------------------------------------------------

■ 1-9. 戦略システム
  複数の戦略をON/OFFで選択し、優先度順（高い順）に評価して
  SP100到達時の発動キャラと行動を決定する。

  【デフォルト優先順位】
  1位: 4段待機（crush4）
       条件: クラッシュ4段時 → ポグラニチニクの戦技を優先発動

  2位: アルデリア優先（alderia）
       腐食中の場合  → アルデリアの戦技を即代理発動（腐食消費→脆弱付与）
       物理異常戦技の発動時点(t1)でクラッシュ=0 かつ
         t2（次の重攻撃）時点で腐食もアルデリア脆弱もない予測の場合
                       → SPを温存（戦技を発動しない）
       SP上限(300)到達時 → 溢れ防止で操作キャラの戦技を強制発動

  3位: リーフォン優先（reephone）
       条件: クラッシュ=0時 → リーフォンの戦技を優先発動（物理脆弱付与）

  いずれの戦略条件も満たさない場合は、操作キャラの戦技を即時発動する。


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  第2章　キャラクターデータ仕様
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

■ 2-1. キャラクター共通フィールド

  フィールド名     型      説明
  ────────────── ──────  ─────────────────────────────────
  id              string  キャラクター識別子（英数字）
  name            string  表示名
  arts            string  アーツ系統（例: 物理）
  weapon          string  武器種（例: 長柄、片手剣）
  damage_type     string  全攻撃手段の基本ダメージ属性
                          ※ 攻撃手段ごとに個別指定も可能

------------------------------------------------------------

■ 2-2. 通常攻撃（normal）フィールド

  フィールド名     型      説明
  ────────────── ──────  ─────────────────────────────────
  sp_regen        number  重攻撃1回で獲得するSP量
  loop_sec        number  重攻撃のループ間隔（秒）
  break_val       number  重攻撃1回のブレイク値
  damage_type     string  このアクションのダメージ属性

------------------------------------------------------------

■ 2-3. 戦技（skill）フィールド

  フィールド名              型       説明
  ────────────────────── ────────  ──────────────────────────────────
  sp_cost                 number   消費SP（現在は全キャラ100固定）
  name                    string   戦技名
  break_val               number   ブレイク値
  damage_type             string   ダメージ属性
  physical_anomaly        string?  物理異常の種類
                                   'knockdown'（転倒）
                                   'float'（浮遊）
                                   'crush'（破砕）
                                   ※ 物理異常なし: フィールドなし
  arts_attachment         string?  アーツ付着の種類（現在は未使用）
  crash_effect            object?  クラッシュへの影響
    .type                 string   'knockdown' / 'float' / 'crush'
    .times                number?  適用回数（省略時は1）
  sp_regen_by_stage       object?  破砕時の段階別SP回復量（破砕専用）
                                   例: {0:0, 1:5, 2:10, 3:20, 4:30}
  consume_corrosion_for_vuln bool? trueの場合、腐食を消費して脆弱を付与
  vuln_dur                number?  脆弱の持続時間（秒）
  vuln_pct_by_rank        object?  スキルランク別の脆弱効果量（%）
                                   例: {'1':12, ..., '特化III':20}

------------------------------------------------------------

■ 2-4. 連携技（chain）フィールド

  フィールド名              型       説明
  ────────────────────── ────────  ──────────────────────────────────
  name                    string   連携技名
  cd_sec                  number   クールダウン（秒）
  trigger                 string   発動トリガー（下記参照）
  break_val               number   ブレイク値
  damage_type             string   ダメージ属性
  grants_link             bool?    trueの場合リンク状態を付与
  applies_float           bool?    trueの場合浮遊効果を追加付与
  applies_corrosion       bool?    trueの場合腐食を付与
  sp_regen_by_consumed    object?  破砕消費段階別SP回復量（破砕連携技専用）

  【triggerの種類】
  'active_heavy_AND_crashed_or_vuln'
      → 操作キャラの重攻撃 かつ（クラッシュ中 または 脆弱中）

  'active_heavy_AND_clean_enemy'
      → いずれかのキャラの重攻撃 かつ クラッシュ=0 かつ アーツ付着なし

  'on_crush_consumed'
      → 破砕（戦技）が消費されたとき

  'on_crash_stage_gained'
      → クラッシュ段階が増加したとき

------------------------------------------------------------

■ 2-5. 必殺技（ult）フィールド

  フィールド名              型       説明
  ────────────────────── ────────  ──────────────────────────────────
  name                    string   必殺技名
  ult_cost                number   必殺技コスト（USC）
  cd_sec                  number?  クールダウン（秒）（省略可）
  break_val               number   ブレイク値
  damage_type             string   ダメージ属性
  physical_anomaly        string?  物理異常の種類（戦技と同様）
  crash_effect            object?  クラッシュへの影響（戦技と同様）
  sp_regen_disrupt        number?  必殺技中の妨害SP回復量
  sp_regen_finisher       number?  必殺技フィニッシャーのSP回復量

------------------------------------------------------------

■ 2-6. 現在の4キャラ データ一覧

  ┌─────────────────┬──────────┬──────┬──────┬──────────┐
  │ キャラ          │ ダメージ  │ 戦技         │ 連携技             │ 必殺技        │
  ├─────────────────┼──────────┼──────┼──────┼──────────┤
  │ リーフォン      │ 物理      │ 転倒・物理脆弱付与 │ クラッシュ/脆弱中にリンク付与 │ 転倒×2 │
  │ ポグラニチニク  │ 物理      │ 破砕・SP回収  │ 破砕時SP回収       │ SP大回収      │
  │ アルデリア      │ 自然      │ 腐食消費→脆弱 │ クラッシュ0で腐食付与 │ なし（汎用） │
  │ チェン・センユー│ 物理      │ 浮遊          │ 段階増加時に浮遊追加  │ 浮遊          │
  └─────────────────┴──────────┴──────┴──────┴──────────┘


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  第3章　シミュレーター設定値
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  設定項目              値
  ─────────────────── ────────────────────────────────────
  SP初期値             200
  SP上限               300
  SP自然回復           8 / 秒
  シミュレーション刻み 0.1秒
  腐食持続時間         7秒（固定）
  脆弱持続時間         スキルランク依存（リーフォン12秒、アルデリア30秒）
  転倒/浮遊間隔        ユーザー設定（デフォルト20秒）
  初期クラッシュ段階   ユーザー設定（デフォルト0）


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  更新履歴
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  v0.1  基本SPシミュレーション
  v0.2  クラッシュシステム・連携技実装
  v0.3  必殺技ゲージ・ポグラニチニク戦技実装
  v0.4  チェン連携技浮遊効果・リーフォン必殺技×2転倒実装
  v0.5  戦略システム・リンク状態・チェン連携技浮遊効果実装
  v0.6  ダメージ属性・物理異常フラグ追加
        アルデリア優先ロジック改訂（物理異常戦技t1基準）
        デバフグラフ（ガントチャート）追加
        イベントログクリックでグラフハイライト
        スキルランク連動の脆弱効果量

================================================================
